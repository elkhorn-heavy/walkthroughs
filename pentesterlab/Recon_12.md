# PentesterLab - Recon 12

PentesterLab offers a series of reconnaissance ("recon") challenges designed to
teach basic security skills.

## Challenge Overview

In this challenge, the goal is to explore the load balanced web servers behind
http://balancer.hackycorp.com. The hint is that we should try to access all web
servers.

Grade: Easy

## Initial Analysis

This seems like it'll be fairly straight-forward. By opening the website in a
browser, the response is "Not yet". This is another hint that we should retry.
By refreshing the page multiple times, eventually a page comes up that says
"Well done! You solved recon_12".

## Takeaways

This challenge demonstrates how a load balancer can be used to spread HTTP
requests across a set of supposedly-identical web servers. The load balancer
accepts HTTP requests and then passes the request on to one of the web servers.
There are various strategies used to decide which web server to call. One common
strategy is called _round robin_, where the load balancer just calls the web
servers in a repeating sequence.

The idea here is that the web servers are supposed to be identical. However,
there could be a misconfiguration where one server has a vulnerability, or it
leaks information that the others don't.

## Beyond the Challenge

In this challenge we know that the load balancer exists, and the subdomain name
of "balancer" also makes this obvious. However, we might not know that a load
balancer exists.

If we look at the response headers, we see something interesting:

```
$ for i in {0..4}; do curl -s -i http://balancer.hackycorp.com | grep ETag; done
ETag: "5f1565e3-12"
ETag: "5f1565ed-12"
ETag: "5f1565e3-12"
ETag: "5f1565ed-12"
ETag: "5f156610-6c"
```

Similarly, we can look at the last modified timestamp for the content:

```
$ for i in {0..4}; do curl -s -i http://balancer.hackycorp.com | grep Last-Modified; done
Last-Modified: Mon, 20 Jul 2020 09:37:39 GMT
Last-Modified: Mon, 20 Jul 2020 09:37:49 GMT
Last-Modified: Mon, 20 Jul 2020 09:38:24 GMT
Last-Modified: Mon, 20 Jul 2020 09:37:39 GMT
Last-Modified: Mon, 20 Jul 2020 09:37:49 GMT
```

So it looks like we have three different servers behind the load balancer. Note
that although we have three different ETags and Last-Modified dates, it doesn't
mean the content has to be different.

### Alternative Methods to Solve the Challenge

If it can be done in a browser, it can be done using `curl`.

```
$ for i in {0..10}; do echo Attempt $i; curl -s http://balancer.hackycorp.com | grep -v "Not yet" | grep -v "^$"; done
Attempt 0
Attempt 1
Attempt 2
Attempt 3
Attempt 4
<h1>Well done! You solved recon_12 </h1>
The key for this exercise is 00000000-0000-0000-0000-000000000000
Attempt 5
Attempt 6
Attempt 7
Attempt 8
Attempt 9
Attempt 10
```

> Note: the real challenge key has been replaced with a fake _UUID_.

Left as an exercise for the reader: make this script more intelligent by
continuing to run until the key is found, and then stopping.
